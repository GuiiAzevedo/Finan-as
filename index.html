    <!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyFinances Pro</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí∞</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí∞</text></svg>">
    <meta name="theme-color" content="#0b0f1a">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        :root {
            --bg: #0b0f1a; --card: #161c2d; --text: #e2e8f0;
            --accent: #6366f1; --entry: #10b981; --exit: #f43f5e;
            --input-bg: #1e293b;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background-color: var(--bg); color: var(--text);
            margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center;
        }

        .container { width: 100%; max-width: 600px; padding-bottom: 50px; }

        .dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .card { background: var(--card); padding: 12px; border-radius: 12px; text-align: center; border: 1px solid #2d3748; }
        .card small { font-size: 0.65rem; color: #94a3b8; text-transform: uppercase; }
        .card div { font-size: 1rem; font-weight: 700; margin-top: 5px; }

        .form-section { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .box { background: var(--card); padding: 15px; border-radius: 15px; border: 1px solid #2d3748; }
        h3 { font-size: 0.85rem; margin: 0 0 12px 0; font-weight: 500; }
        
        input, select {
            width: 100%; padding: 10px; margin-bottom: 8px; border-radius: 8px;
            border: none; background: var(--input-bg); color: white; font-size: 0.85rem;
        }

        button { width: 100%; padding: 10px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; }
        .btn-entry { background: var(--entry); color: white; }
        .btn-exit { background: var(--exit); color: white; }
        
        .chart-container { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #2d3748; height: 250px; }
        
        .history { background: var(--card); border-radius: 15px; border: 1px solid #2d3748; }
        .item { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; border-bottom: 1px solid #2d3748; }
        .item:last-child { border: none; }
        
        .btn-icon { background: none; border: none; color: #94a3b8; width: auto; font-size: 1rem; }
        
        .backup-zone { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .btn-util { background: #334155; color: white; font-size: 0.75rem; }

        @media (max-width: 480px) { .form-section { grid-template-columns: 1fr; } .dashboard { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container" id="app-content">
    <h2 style="font-weight: 300; text-align: center; margin-bottom: 20px;">üí∞ MyFinances</h2>

    <div class="dashboard">
        <div class="card"><small>Ganhos</small><div id="t-entry" style="color:var(--entry)">R$ 0</div></div>
        <div class="card"><small>Gastos</small><div id="t-exit" style="color:var(--exit)">R$ 0</div></div>
        <div class="card"><small>Saldo</small><div id="t-balance">R$ 0</div></div>
    </div>

    <div class="form-section">
        <div class="box">
            <h3 style="color:var(--entry)">Entrada</h3>
            <input type="text" id="e-desc" placeholder="O que recebeu?">
            <input type="number" id="e-val" placeholder="Valor">
            <select id="e-cat"><option value="Sal√°rio">Sal√°rio</option><option value="Extra">Extra</option></select>
            <button class="btn-entry" onclick="addItem(true)">+ Adicionar</button>
        </div>
        <div class="box">
            <h3 style="color:var(--exit)">Sa√≠da</h3>
            <input type="text" id="s-desc" placeholder="O que pagou?">
            <input type="number" id="s-val" placeholder="Valor">
            <select id="s-cat">
                <option value="Moradia">Moradia</option><option value="Contas">Contas</option>
                <option value="Cart√£o">Cart√£o</option><option value="Lazer">Lazer</option>
            </select>
            <button class="btn-exit" onclick="addItem(false)">- Adicionar</button>
        </div>
    </div>

    <div class="chart-container" id="c-box"><canvas id="myChart"></canvas></div>
    <div class="history" id="list"></div>

    <button class="btn-util" style="margin-top:20px; width:100%; background:var(--accent)" onclick="exportPDF()">üìÑ Gerar Relat√≥rio PDF</button>

    <div class="backup-zone">
        <button class="btn-util" onclick="exportBackup()">üì• Exportar Dados</button>
        <button class="btn-util" onclick="document.getElementById('importFile').click()">üì§ Importar Dados</button>
        <input type="file" id="importFile" style="display:none" onchange="importBackup(event)">
    </div>

    <p onclick="clearAll()" style="text-align:center; color:#475569; font-size:0.6rem; margin-top:30px; cursor:pointer">ZERAR TODOS OS DADOS</p>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('fin_v4')) || [];
    let chart;

    function addItem(isIn) {
        const p = isIn ? 'e-' : 's-';
        const d = document.getElementById(p+'desc').value;
        const v = parseFloat(document.getElementById(p+'val').value);
        if(!d || isNaN(v)) return;
        db.push({ id: Date.now(), desc: d, val: v, cat: document.getElementById(p+'cat').value, type: isIn ? 'in' : 'out' });
        save();
        document.getElementById(p+'desc').value = ''; document.getElementById(p+'val').value = '';
    }

    function editItem(id) {
        const i = db.find(x => x.id === id);
        const p = i.type === 'in' ? 'e-' : 's-';
        document.getElementById(p+'desc').value = i.desc;
        document.getElementById(p+'val').value = i.val;
        db = db.filter(x => x.id !== id);
        save();
    }

    function save() { localStorage.setItem('fin_v4', JSON.stringify(db)); render(); }

    function render() {
        const l = document.getElementById('list'); l.innerHTML = '';
        let tin = 0, tout = 0;
        db.slice().reverse().forEach(i => {
            if(i.type === 'in') tin += i.val; else tout += i.val;
            l.innerHTML += `<div class="item">
                <div><strong>${i.desc}</strong><br><small style="color:#64748b">${i.cat}</small></div>
                <div style="display:flex; align-items:center; gap:10px">
                    <span class="${i.type === 'in' ? 'color:var(--entry)' : 'color:var(--exit)'}">R$ ${i.val.toFixed(2)}</span>
                    <button class="btn-icon" onclick="editItem(${i.id})">‚úèÔ∏è</button>
                    <button class="btn-icon" onclick="if(confirm('Apagar?')) {db=db.filter(x=>x.id!==${i.id});save()}">üóëÔ∏è</button>
                </div>
            </div>`;
        });
        document.getElementById('t-entry').innerText = `R$ ${tin.toFixed(2)}`;
        document.getElementById('t-exit').innerText = `R$ ${tout.toFixed(2)}`;
        document.getElementById('t-balance').innerText = `R$ ${(tin - tout).toFixed(2)}`;
        updateChart();
    }

    function updateChart() {
        const ctx = document.getElementById('myChart').getContext('2d');
        const outs = db.filter(i => i.type === 'out');
        const cats = [...new Set(outs.map(i => i.cat))];
        const vals = cats.map(c => outs.filter(i => i.cat === c).reduce((a, b) => a + b.val, 0));
        if(chart) chart.destroy();
        if(vals.length === 0) { document.getElementById('c-box').style.display='none'; return; }
        document.getElementById('c-box').style.display='block';
        chart = new Chart(ctx, {
            type: 'doughnut',
            data: { labels: cats, datasets: [{ data: vals, backgroundColor: ['#6366f1', '#10b981', '#f43f5e', '#f59e0b'], borderWidth: 0 }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { color: '#94a3b8' } } } }
        });
    }

    function exportPDF() {
        const el = document.getElementById('app-content');
        html2pdf().from(el).set({ margin: 5, filename: 'financas.pdf', html2canvas: { scale: 2, backgroundColor: '#0b0f1a' } }).save();
    }

    function exportBackup() {
        const blob = new Blob([JSON.stringify(db)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'backup_financas.json'; a.click();
    }

    function importBackup(e) {
        const reader = new FileReader();
        reader.onload = (ev) => { db = JSON.parse(ev.target.result); save(); };
        reader.readAsText(e.target.files[0]);
    }

    function clearAll() { if(confirm("Limpar tudo?")) { db = []; save(); } }

    // Service Worker para Offline
    if ('serviceWorker' in navigator) { navigator.serviceWorker.register('./sw.js'); }

    render();
</script>
</body>
</html>
